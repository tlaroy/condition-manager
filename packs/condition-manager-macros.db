{"name":"Console","permission":{"default":0,"XVSPVFXTX27o6cJc":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.OgDK9DuYgXxCYYwr"}},"scope":"global","command":"/**\n * Critical and Fumble Tables.\n *\n *      Console Macro\n *      v0.0.5\n *\n * Console macro to enable/disable module hook.\n */\n\nconsole.log(\"*** CRITICAL AND FUMBLE TABLES - CONSOLE ***\");\n\n// -----------------------------------------------\n// dialog.\n\nfunction dialogDisableTemplate() {\n    return `<form><div>\n                <h2>Console</label></h2>\n                </br><label>Critical and Fumble Tables are: ENABLED</label></br></br></br>\n            </div></form>`;\n}\n\nfunction dialogEnableTemplate() {\n    return `<form><div>\n                <h2>Console</label></h2>\n                </br><label>Critical and Fumble Tables are: DISABLED</label></br></br></br>\n            </div></form>`;\n}\n\nfunction showDialog(enabled_state) {\n    var dialog;\n    if (enabled_state) {\n        // disable dialog.\n        dialog = new Dialog({\n            title: \"Critical and Fumble Tables\",\n            content: dialogDisableTemplate(),\n            buttons: {\n                // continue with callback.\n                disable: {\n                    icon: \"<i class='fas fa-toggle-off'></i>\",\n                    label: \"Disable\",\n                    callback: async (html) => { callbackDisable() }\n                },\n                // or cancel and done.\n                cancel: {\n                    icon: \"<i class='fas fa-times'></i>\",\n                    label: \"Cancel\",\n                    callback: async (html) => { },\n                }\n            },\n            default: \"disable\",\n            close: async (html) => { },\n        }).render(true);\n    }\n    else {\n        // enable dialog.\n        dialog = new Dialog({\n            title: \"Critical and Fumble Tables\",\n            content: dialogEnableTemplate(),\n            buttons: {\n                // continue with callback.\n                enable: {\n                    icon: \"<i class='fas fa-toggle-on'></i>\",\n                    label: \"Enable\",\n                    callback: async (html) => { callbackEnable() }\n                },\n                // or cancel and done.\n                cancel: {\n                    icon: \"<i class='fas fa-times'></i>\",\n                    label: \"Cancel\",\n                    callback: async (html) => { },\n                }\n            },\n            default: \"enable\",\n            close: async (html) => { },\n        }).render(true);\n    }\n}\n\n// -----------------------------------------------\n// dialog callbacks.\n\n// enable.\nasync function callbackEnable() {\n    game.CriticalFumble.enableTables();\n}\n\n// disable.\nasync function callbackDisable() {\n    game.CriticalFumble.disableTables();\n}\n\n// -----------------------------------------------\n// main.\n\nfunction main() {\n    if (!game.user.isGM) return;\n    showDialog(game.CriticalFumble.isEnabled());\n}\n\nmain();","author":"XVSPVFXTX27o6cJc","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"YbL6fxBamdEPQsTc"}
{"name":"Examples","permission":{"default":0,"XVSPVFXTX27o6cJc":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.Bw1LrTH2rxtcppvR"}},"scope":"global","command":"/**\n * Critical and Fumble Tables.\n *\n *      Examples Macro\n *      v0.0.5\n *\n * Example macro demonstrating calls to the module.\n */\n\nconsole.log(\"*** CRITICAL AND FUMBLE TABLES - EXAMPLES ***\");\n\n// -------------------------------------------------------\n// arguments.\n\nif (args.length == 0) {\n    console.log(\"*** No arguments passed.\");\n} else {\n    for (var i = 0; i < args.length; i++) {\n        console.log(\"*** Argument[\", i, \"]: \", args[i]);\n    }\n    return;\n}\n\n// -----------------------------------------------\n// dialog.\n\nfunction dialogTemplate() {\n    return `<form><div>\n                <h2>Example</label></h2>\n                </br><label>Target Blinded Condition</label></br></br></br>\n            </div></form>`;\n}\n\nfunction showDialog() {\n    var dialog = new Dialog({\n        title: \"Critical and Fumble Tables\",\n        content: dialogTemplate(),\n        buttons: {\n            // continue with callbacks.\n            apply: {\n                icon: \"<i class='fas fa-toggle-off'></i>\",\n                label: \"Apply\",\n                callback: async (html) => { callbackApply();  dialog.render(true); }\n            },\n            update: {\n                icon: \"<i class='fas fa-toggle-off'></i>\",\n                label: \"Update\",\n                callback: async (html) => { callbackUpdate(); dialog.render(true); }\n            },\n            remove: {\n                icon: \"<i class='fas fa-toggle-off'></i>\",\n                label: \"Remove\",\n                callback: async (html) => { callbackRemove(); dialog.render(true); }\n            },\n            // or cancel and done.\n            cancel: {\n                icon: \"<i class='fas fa-times'></i>\",\n                label: \"Cancel\",\n                callback: async (html) => { },\n            }\n        },\n        default: \"cancel\",\n        close:   async (html) => { },\n    }).render(true);\n}\n\n// -----------------------------------------------\n// dialog callbacks.\n\n// apply condition to target and set duration.\n\nasync function callbackApply() {\n    // get target.\n    var target = getTargetedToken();\n    if (target == null) return false;\n\n    // get CriticalFumble namespace.\n    var cfn = game.CriticalFumble;\n    if (cfn == null) return false;\n\n    // get condition manager.\n    var mgr = cfn.getConditionManager();\n    if (mgr == null) return false;\n\n    var retval;\n\n    // apply.\n    retval = await mgr.apply(cfn.CONST.BLEEDING_LABEL, target);\n    if (!retval) return false;\n\n    // set duration of turns to 2.\n    retval = await mgr.setDuration(cfn.CONST.BLEEDING_LABEL, cfn.CONST.TURNS, 2, target);\n    if (!retval) return false;\n\n    return true;\n}\n\n// update condition on a target changing durations.\n\nasync function callbackUpdate() {\n    // get target.\n    var target = getTargetedToken();\n    if (target == null) return false;\n\n    // get CriticalFumble namespace.\n    var cfn = game.CriticalFumble;\n    if (cfn == null) return false;\n\n    // get condition manager.\n    var mgr = cfn.getConditionManager();\n    if (mgr == null) return false;\n\n    var retval;\n\n    // set effect attribute value to -10 (default is 3).\n\tretval = await mgr.setEffectAttribute(cfn.CONST.BLEEDING_LABEL, cfn.CONST.ATTRIBUTE_HP_KEY, cfn.CONST.ATTRIBUTE_VALUE, -10, target);\n\n    // set duration of turns to null (was set to 2 by apply).\n    retval = await mgr.setDuration(cfn.CONST.BLEEDING_LABEL, cfn.CONST.TURNS, null, target);\n    if (!retval) return false;\n\n    // set duration of rounds to 10.\n    retval = await mgr.setDuration(cfn.CONST.BLEEDING_LABEL, cfn.CONST.ROUNDS, 10, target);\n    if (!retval) return false;\n\n    return true;\n}\n\n// remove condition on target.\n\nasync function callbackRemove() {\n    // get target.\n    var target = getTargetedToken();\n    if (target == null) return false;\n\n    // get CriticalFumble namespace.\n    var cfn = game.CriticalFumble;\n    if (cfn == null) return false;\n\n    // get condition manager.\n    var mgr = cfn.getConditionManager();\n    if (mgr == null) return false;\n\n    var retval;\n\n    // remove.\n    retval = await mgr.remove(cfn.CONST.BLEEDING_LABEL, target);\n    if (!retval) return false;\n\n    return true;\n}\n\n// -----------------------------------------------\n// get tokens.\n\n// selected.\nfunction getSelectedToken() {\n    // selected actors.\n    var selects = canvas.tokens.controlled;\n    if (selects === undefined) return null;\n    // if we want one, and only one.\n    if (selects.length == 0 || selects.length > 1) {\n        console.log(\"*** No token selected.\");\n        return null;\n    }\n    // selected actor.\n    var select = canvas.tokens.controlled[0];\n    //console.log(String(\"*** Selected Actor:       [\" + select.data.name + \"]\"));\n    return select;\n}\n\n// targeted.\nfunction getTargetedToken() {\n    // targeted actors.\n    var targets = Array.from(game.user.targets);\n    if (targets === undefined) return null;\n    // if we want one, and only one.\n    if (targets.length == 0 || targets.length > 1) {\n        console.log(\"*** No token targeted.\");\n        return null;\n    }\n    // targeted actor.\n    var target = targets[0].actor;\n    //console.log(String(\"*** Targeted Actor:       [\" + target.data.name + \"]\"));\n    return target;\n}\n\n// -----------------------------------------------\n// main.\n\nfunction main() {\n    if (!game.user.isGM) return;\n\n    // get CriticalFumble namespace.\n    var cfn = game.CriticalFumble;\n\n    // is midi-critical-fumble enabled?\n    var enabled = cfn.isEnabled();\n    if (!enabled) cfn.enableTables();\n\n    showDialog();\n}\n\nmain();","author":"XVSPVFXTX27o6cJc","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"gsexTvFICXh27Bvq"}
{"$$deleted":true,"_id":"YbL6fxBamdEPQsTc"}
{"$$deleted":true,"_id":"gsexTvFICXh27Bvq"}
{"name":"Console","permission":{"default":0,"XVSPVFXTX27o6cJc":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.OgDK9DuYgXxCYYwr"}},"scope":"global","command":"/**\n * Critical and Fumble Tables.\n *\n *      Console Macro\n *      v0.0.6\n *\n * Console macro to enable/disable module hook.\n */\n\nconsole.info(String(game.CriticalFumble.CF_CONST.CF_LABEL + \" | %c\" + game.CriticalFumble.CF_CONST.CF_NAME + \"%c v\" + game.CriticalFumble.CF_CONST.CF_VERSION + \" - CONSOLE\" + \".\"), \"color:\" + game.CriticalFumble.CF_CONST.CONSOLE_GREEN, \"color:\" + game.CriticalFumble.CF_CONST.CONSOLE_DEFAULT);\n\n/**\n* dialog.\n*/\n\nfunction dialogDisableTemplate() {\n    return `<form><div>\n                <h2>Console</label></h2>\n                </br><label>Critical and Fumble Tables are: ENABLED</label></br></br></br>\n            </div></form>`;\n}\n\nfunction dialogEnableTemplate() {\n    return `<form><div>\n                <h2>Console</label></h2>\n                </br><label>Critical and Fumble Tables are: DISABLED</label></br></br></br>\n            </div></form>`;\n}\n\nfunction showDialog(enabled_state) {\n    var dialog;\n    if (enabled_state) {\n        // disable dialog.\n        dialog = new Dialog({\n            title: \"Critical and Fumble Tables\",\n            content: dialogDisableTemplate(),\n            buttons: {\n                // continue with callback.\n                disable: {\n                    icon: \"<i class='fas fa-toggle-off'></i>\",\n                    label: \"Disable\",\n                    callback: async (html) => { callbackDisable() }\n                },\n                // or cancel and done.\n                cancel: {\n                    icon: \"<i class='fas fa-times'></i>\",\n                    label: \"Cancel\",\n                    callback: async (html) => { },\n                }\n            },\n            default: \"disable\",\n            close: async (html) => { },\n        }).render(true);\n    }\n    else {\n        // enable dialog.\n        dialog = new Dialog({\n            title: \"Critical and Fumble Tables\",\n            content: dialogEnableTemplate(),\n            buttons: {\n                // continue with callback.\n                enable: {\n                    icon: \"<i class='fas fa-toggle-on'></i>\",\n                    label: \"Enable\",\n                    callback: async (html) => { callbackEnable() }\n                },\n                // or cancel and done.\n                cancel: {\n                    icon: \"<i class='fas fa-times'></i>\",\n                    label: \"Cancel\",\n                    callback: async (html) => { },\n                }\n            },\n            default: \"enable\",\n            close: async (html) => { },\n        }).render(true);\n    }\n}\n\n/**\n* dialog callbacks.\n*/\n\nasync function callbackEnable() {\n    game.CriticalFumble.enableTables();\n}\n\nasync function callbackDisable() {\n    game.CriticalFumble.disableTables();\n}\n\n/**\n* main.\n*/\n\nfunction main() {\n    if (!game.user.isGM) return;\n    showDialog(game.CriticalFumble.isEnabled());\n}\n\nmain();","author":"XVSPVFXTX27o6cJc","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"KuIDQVtbPtuSfX6u"}
{"name":"Examples","permission":{"default":0,"XVSPVFXTX27o6cJc":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"core":{"sourceId":"Macro.Bw1LrTH2rxtcppvR"}},"scope":"global","command":"/**\n * Critical and Fumble Tables.\n *\n *      Examples Macro\n *      v0.0.6\n *\n * Example macro demonstrating calls to the module.\n */\n\nconsole.info(String(game.CriticalFumble.CF_CONST.CF_LABEL + \" | %c\" + game.CriticalFumble.CF_CONST.CF_NAME + \"%c v\" + game.CriticalFumble.CF_CONST.CF_VERSION + \" - EXAMPLES\" + \".\"), \"color:\" + game.CriticalFumble.CF_CONST.CONSOLE_GREEN, \"color:\" + game.CriticalFumble.CF_CONST.CONSOLE_DEFAULT);\n\n/**\n* arguments.\n*/\n\nif (args.length == 0) {\n    console.info(game.CriticalFumble.CF_CONST.CF_LABEL + \" | No arguments passed.\");\n} else {\n    for (var i = 0; i < args.length; i++) {\n        console.info(game.CriticalFumble.CF_CONST.CF_LABEL + \" | Argument[\", i, \"]: \", args[i]);\n    }\n    return;\n}\n\n/**\n* dialog.\n*/\n\nfunction dialogTemplate() {\n    return `<form><div>\n                <h2>Example</label></h2>\n                </br><label>Target Blinded Condition</label></br></br></br>\n            </div></form>`;\n}\n\nfunction showDialog() {\n    var dialog = new Dialog({\n        title: \"Critical and Fumble Tables\",\n        content: dialogTemplate(),\n        buttons: {\n            // continue with callbacks.\n            apply: {\n                icon: \"<i class='fas fa-toggle-off'></i>\",\n                label: \"Apply\",\n                callback: async (html) => { callbackApply();  dialog.render(true); }\n            },\n            update: {\n                icon: \"<i class='fas fa-toggle-off'></i>\",\n                label: \"Update\",\n                callback: async (html) => { callbackUpdate(); dialog.render(true); }\n            },\n            remove: {\n                icon: \"<i class='fas fa-toggle-off'></i>\",\n                label: \"Remove\",\n                callback: async (html) => { callbackRemove(); dialog.render(true); }\n            },\n            // or cancel and done.\n            cancel: {\n                icon: \"<i class='fas fa-times'></i>\",\n                label: \"Cancel\",\n                callback: async (html) => { },\n            }\n        },\n        default: \"cancel\",\n        close:   async (html) => { },\n    }).render(true);\n}\n\n/**\n* dialog callbacks.\n*/\n\nasync function callbackApply() {\n    // get target.\n    var target = getTargetedToken();\n    if (target == null) return false;\n\n    // get CriticalFumble namespace.\n    var cfn = game.CriticalFumble;\n    if (cfn == null) return false;\n\n    // get condition manager.\n    var mgr = cfn.getConditionManager();\n    if (mgr == null) return false;\n\n    var retval;\n\n    // apply.\n    retval = await mgr.apply(cfn.CF_CONST.BLEEDING_LABEL, target);\n    if (!retval) return false;\n\n    // set duration of turns to 2.\n    retval = await mgr.setDuration(cfn.CF_CONST.BLEEDING_LABEL, cfn.CF_CONST.TURNS, 2, target);\n    if (!retval) return false;\n\n    return true;\n}\n\nasync function callbackUpdate() {\n    // get target.\n    var target = getTargetedToken();\n    if (target == null) return false;\n\n    // get CriticalFumble namespace.\n    var cfn = game.CriticalFumble;\n    if (cfn == null) return false;\n\n    // get condition manager.\n    var mgr = cfn.getConditionManager();\n    if (mgr == null) return false;\n\n    var retval;\n\n    // set effect attribute value to -10 (default is 3).\n    retval = await mgr.setEffectAttribute(cfn.CF_CONST.BLEEDING_LABEL, cfn.CF_CONST.ATTRIBUTE_HP_KEY, cfn.CF_CONST.ATTRIBUTE_VALUE, -10, target);\n    if (!retval) return false;\n\n    // set duration of turns to null (was set to 2 by apply).\n    retval = await mgr.setDuration(cfn.CF_CONST.BLEEDING_LABEL, cfn.CF_CONST.TURNS, null, target);\n    if (!retval) return false;\n\n    // set duration of rounds to 10.\n    retval = await mgr.setDuration(cfn.CF_CONST.BLEEDING_LABEL, cfn.CF_CONST.ROUNDS, 10, target);\n    if (!retval) return false;\n\n    return true;\n}\n\nasync function callbackRemove() {\n    // get target.\n    var target = getTargetedToken();\n    if (target == null) return false;\n\n    // get CriticalFumble namespace.\n    var cfn = game.CriticalFumble;\n    if (cfn == null) return false;\n\n    // get condition manager.\n    var mgr = cfn.getConditionManager();\n    if (mgr == null) return false;\n\n    var retval;\n\n    // remove.\n    retval = await mgr.remove(cfn.CF_CONST.BLEEDING_LABEL, target);\n    if (!retval) return false;\n\n    return true;\n}\n\n/**\n* get tokens.\n*/\n\nfunction getSelectedToken() {\n    // selected actors.\n    var selects = canvas.tokens.controlled;\n    if (selects === undefined) return null;\n    // if we want one, and only one.\n    if (selects.length == 0 || selects.length > 1) {\n        console.warn(game.CriticalFumble.CF_CONST.CF_LABEL + \" | No token selected.\");\n        return null;\n    }\n    // selected actor.\n    var select = canvas.tokens.controlled[0];\n    return select;\n}\n\nfunction getTargetedToken() {\n    // targeted actors.\n    var targets = Array.from(game.user.targets);\n    if (targets === undefined) return null;\n    // if we want one, and only one.\n    if (targets.length == 0 || targets.length > 1) {\n        console.warn(game.CriticalFumble.CF_CONST.CF_LABEL + \" | No token targeted.\");\n        return null;\n    }\n    // targeted actor.\n    var target = targets[0].actor;\n    return target;\n}\n\n/**\n* main.\n*/\n\nfunction main() {\n    if (!game.user.isGM) return;\n\n    // get CriticalFumble namespace.\n    var cfn = game.CriticalFumble;\n\n    // is midi-critical-fumble enabled?\n    var enabled = cfn.isEnabled();\n    if (!enabled) cfn.enableTables();\n\n    showDialog();\n}\n\nmain();","author":"XVSPVFXTX27o6cJc","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"Qd2jLvIAodq7ljn1"}
